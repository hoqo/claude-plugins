{
	"_note": "Values like ISODate('...') and ObjectId('...') are template placeholders. In mongosh they are native types; in JSON they are represented as strings.",
	"patterns": [
		{
			"name": "Count by category",
			"description": "Group documents and count per category",
			"query": [
				{ "$group": { "_id": "$category", "count": { "$sum": 1 } } },
				{ "$sort": { "count": -1 } }
			]
		},
		{
			"name": "Date range filter",
			"description": "Find documents within a date range",
			"query": {
				"createdAt": {
					"$gte": "ISODate('2024-01-01')",
					"$lt": "ISODate('2025-01-01')"
				}
			}
		},
		{
			"name": "Nested field update",
			"description": "Update a nested field in a document",
			"operation": "updateOne",
			"filter": { "_id": "ObjectId('...')" },
			"update": { "$set": { "address.city": "New York" } }
		},
		{
			"name": "Array element match",
			"description": "Find documents where array contains matching element",
			"query": {
				"tags": { "$elemMatch": { "name": "featured", "active": true } }
			}
		},
		{
			"name": "Computed aggregation with metrics",
			"description": "Calculate multiple metrics per group",
			"query": [
				{ "$match": { "status": "completed" } },
				{
					"$group": {
						"_id": "$userId",
						"totalSpent": { "$sum": "$amount" },
						"avgOrder": { "$avg": "$amount" },
						"orderCount": { "$sum": 1 },
						"lastOrder": { "$max": "$date" },
						"firstOrder": { "$min": "$date" }
					}
				},
				{ "$sort": { "totalSpent": -1 } },
				{ "$limit": 20 }
			]
		},
		{
			"name": "Unwind and regroup",
			"description": "Explode an array field and re-aggregate",
			"query": [
				{ "$unwind": "$items" },
				{
					"$group": {
						"_id": "$items.productId",
						"totalSold": { "$sum": "$items.quantity" },
						"revenue": { "$sum": { "$multiply": ["$items.price", "$items.quantity"] } }
					}
				},
				{ "$sort": { "revenue": -1 } }
			]
		}
	]
}
